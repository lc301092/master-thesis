<!doctype html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<title>Game 1 </title>
	<script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
	<style type="text/css">
		body {
			margin: 0;
		}

	</style>
</head>

<body>

	<script type="text/javascript">
		const config = {
			type: Phaser.AUTO,
			width: 1600,
			height: 1200,
			physics: {
				default: 'arcade',
				arcade: {
					gravity: {
						y: 0
					},
					debug: false
				}
			},
			scene: {
				preload: preload,
				create: create,
				update: update
			}
		};

		const game = new Phaser.Game(config);
		let cursors;
		let scene;
		let player;
		let playerBody;
		let speed = 1;

		let keys;
		let singlePress = Phaser.Input.Keyboard.JustDown;
		let zeroVector = Phaser.Math.Vector2.ZERO;
		let up = new Phaser.Math.Vector2(0, -1);
		let down = new Phaser.Math.Vector2(0, 1);
		let right = new Phaser.Math.Vector2(1, 0);
		let left = new Phaser.Math.Vector2(-1, 0);
		let interact;


		let playerAnimation;

		function preload() {
			this.load.image('map', 'assets/map2.png');
			this.load.spritesheet('dude', 'assets/dude.png', {
				frameWidth: 32,
				frameHeight: 48
			});
			this.load.spritesheet('portal', 'assets/portal.png', {
				frameWidth: 250,
				frameHeight: 592
			});
		}

		// ### create ### 


		function create() {
			scene = this;
			scene.cameras.main.setBounds(0, 0, 1920 * 2, 1080 * 2);
			scene.physics.world.setBounds(0, 0, 1920 * 2, 1080 * 2);

			let map = scene.add.image(0, 0, 'map').setOrigin(0);
			scene.player = scene.physics.add.sprite(400, 300, 'dude');
			player = scene.player;
			playerAnimation = scene.player.anims;

			scene.player.setCollideWorldBounds(true);

			scene.cameras.main.startFollow(scene.player, true, 0.05, 0.05);

			animationSetup(scene);


			let portals = scene.physics.add.staticGroup();
			//let portal = scene.add.sprite(780, 820, 'portal').play('idle').setScale(0.25);
			let portal = portals.create(780, 820, 'portal').play('idle').setScale(0.25);
			portal.setCollideWorldBounds(true);

			this.physics.add.collider(player, portals, null, null, this);

			keys = scene.input.keyboard.addKeys({
				up: 'W',
				down: 'S',
				left: 'A',
				right: 'D',
				interact: 'E'

			});
			//keys.interact.emitOnRepeat = true;


		}

		function update() {

			playerControl();

		}

		function playerControl() {

			// this will be the velocity when no keys are pressed
			player.setVelocity(0, 0);


			if (keys.up.isDown) {
				player.setVelocityY(-150);
			} else if (keys.down.isDown) {
				player.setVelocityY(150);
			}

			if (keys.left.isDown) {
				player.setVelocityX(-150);
				playerAnimation.play('left', true);

			} else if (keys.right.isDown) {
				player.setVelocityX(150);
				playerAnimation.play('right', true);
			} else {
				playerAnimation.play('turn', true);

			}

			if (singlePress(keys.interact)) console.log(keys.interact);;



		}

		function animationSetup(scene) {
			scene.anims.create({
				key: 'idle',
				frames: scene.anims.generateFrameNumbers('portal', {
					start: 0,
					end: 3
				}),
				frameRate: 8,
				repeat: -1
			});

			scene.anims.create({
				key: 'left',
				frames: scene.anims.generateFrameNumbers('dude', {
					start: 0,
					end: 3
				}),
				frameRate: 10,
				repeat: -1
			});

			scene.anims.create({
				key: 'turn',
				frames: [{
					key: 'dude',
					frame: 4
				}],
				frameRate: 20
			});

			scene.anims.create({
				key: 'right',
				frames: scene.anims.generateFrameNumbers('dude', {
					start: 5,
					end: 8
				}),
				frameRate: 10,
				repeat: -1
			});
		}

	</script>

</body>

</html>
